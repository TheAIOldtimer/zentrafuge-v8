<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zentrafuge Onboarding ‚Äì Meet Cael</title>
  <link rel="icon" href="Zentrafuge-WIDE-Logo-Transparent.png">
  <link rel="stylesheet" href="css/core/reset.css">
  <link rel="stylesheet" href="css/core/variables.css">
  <link rel="stylesheet" href="css/core/typography.css">
  <link rel="stylesheet" href="css/components/buttons.css">
  <link rel="stylesheet" href="css/components/forms.css">
  <link rel="stylesheet" href="css/components/loading.css">
  <link rel="stylesheet" href="css/pages/onboarding.css">
</head>
<body>
  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-spinner-large"></div>
  </div>

  <div class="top-language-bar">
    <div class="language-dropdown-container">
      <div class="language-dropdown" id="language-toggle">
        <span class="language-flag" id="selected-flag">üåç</span>
        <span class="language-name" id="selected-language">Loading...</span>
        <span class="language-dropdown-arrow">‚ñº</span>
      </div>
      <div class="language-options-dropdown" id="language-dropdown"></div>
    </div>
  </div>

  <header>
    <img src="Zentrafuge-WIDE-Logo-Transparent.png" alt="Zentrafuge Logo" onerror="this.style.display='none'; document.querySelector('.header-fallback').style.display='block';" />
    <div class="header-fallback" style="display: none;">Zentrafuge</div>
  </header>

  <div class="onboarding-container">
    <div class="auth-notice" id="auth-notice">
      <span data-translate="authNotice">Loading...</span> <a href="index.html" data-translate="loginLink">Log in</a>
    </div>
    <div class="status-message" id="status-message"></div>
    <div class="progress-indicator">
      <div class="progress-dot active" data-step="0"></div>
      <div class="progress-dot" data-step="1"></div>
      <div class="progress-dot" data-step="2"></div>
      <div class="progress-dot" data-step="3"></div>
      <div class="progress-dot" data-step="4"></div>
    </div>

    <div class="onboarding-box" id="step-0">
      <h2 data-translate="welcomeTitle">Welcome to Zentrafuge</h2>
      <div class="cael-intro" data-translate="caelIntro"></div>
      <p data-translate="welcomeDescription"></p>
      <div class="navigation-buttons">
        <div></div>
        <button class="btn btn-primary" id="begin-button" disabled data-translate="beginButton">Begin</button>
      </div>
    </div>

    <div class="onboarding-box hidden" id="step-1">
      <div class="theme-header" data-translate="safetyHeader"></div>
      <div class="question-section">
        <label class="question-label" data-translate="communicationQuestion"></label>
        <div class="question-context" data-translate="communicationContext"></div>
        <div class="multi-choice">
          <div class="multi-choice-item">
            <input type="radio" id="heard-direct" name="communication_style" value="direct_feedback" />
            <label for="heard-direct" data-translate="directLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="radio" id="heard-gentle" name="communication_style" value="gentle_exploration" />
            <label for="heard-gentle" data-translate="gentleLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="radio" id="heard-witness" name="communication_style" value="just_witnessing" />
            <label for="heard-witness" data-translate="witnessLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="radio" id="heard-mix" name="communication_style" value="mix_depends" />
            <label for="heard-mix" data-translate="mixLabel"></label>
          </div>
        </div>
      </div>
      <div class="question-section">
        <label class="question-label" data-translate="processingQuestion"></label>
        <div class="question-context" data-translate="processingContext"></div>
        <div class="multi-choice">
          <div class="multi-choice-item">
            <input type="radio" id="process-deep" name="emotional_pacing" value="dive_deep_quickly" />
            <label for="process-deep" data-translate="deepLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="radio" id="process-gradual" name="emotional_pacing" value="circle_gradually" />
            <label for="process-gradual" data-translate="gradualLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="radio" id="process-varies" name="emotional_pacing" value="varies_situation" />
            <label for="process-varies" data-translate="variesLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="radio" id="process-unsure" name="emotional_pacing" value="not_sure_yet" />
            <label for="process-unsure" data-translate="unsureLabel"></label>
          </div>
        </div>
      </div>
      <div class="navigation-buttons">
        <button class="btn btn-secondary" data-translate="backButton">Back</button>
        <button class="btn btn-primary" data-translate="continueButton">Continue</button>
      </div>
    </div>

    <div class="onboarding-box hidden" id="step-2">
      <div class="theme-header" data-translate="identityHeader"></div>
      <div class="question-section">
        <label class="question-label" data-translate="lifeChapterQuestion"></label>
        <div class="question-context" data-translate="lifeChapterContext"></div>
        <input type="text" id="life_chapter" name="life_chapter" data-translate-placeholder="lifeChapterPlaceholder" />
      </div>
      <div class="question-section">
        <label class="question-label" data-translate="meaningQuestion"></label>
        <div class="question-context" data-translate="meaningContext"></div>
        <div class="multi-choice">
          <div class="multi-choice-item">
            <input type="checkbox" id="meaning-creative" name="sources_of_meaning" value="creative_work" />
            <label for="meaning-creative" data-translate="creativeLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="meaning-helping" name="sources_of_meaning" value="helping_others" />
            <label for="meaning-helping" data-translate="helpingLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="meaning-nature" name="sources_of_meaning" value="being_in_nature" />
            <label for="meaning-nature" data-translate="natureLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="meaning-learning" name="sources_of_meaning" value="learning_growing" />
            <label for="meaning-learning" data-translate="learningLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="meaning-connection" name="sources_of_meaning" value="deep_connections" />
            <label for="meaning-connection" data-translate="connectionLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="meaning-other" name="sources_of_meaning" value="something_else" />
            <label for="meaning-other" data-translate="otherLabel"></label>
          </div>
        </div>
      </div>
      <div class="navigation-buttons">
        <button class="btn btn-secondary" data-translate="backButton">Back</button>
        <button class="btn btn-primary" data-translate="continueButton">Continue</button>
      </div>
    </div>

    <div class="onboarding-box hidden" id="step-3">
      <div class="theme-header" data-translate="supportHeader"></div>
      <div class="question-section">
        <label class="question-label" data-translate="supportQuestion"></label>
        <div class="question-context" data-translate="supportContext"></div>
        <div class="multi-choice">
          <div class="multi-choice-item">
            <input type="checkbox" id="support-listening" name="effective_support" value="deep_listening" />
            <label for="support-listening" data-translate="listeningLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="support-practical" name="effective_support" value="practical_solutions" />
            <label for="support-practical" data-translate="practicalLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="support-challenge" name="effective_support" value="gentle_challenges" />
            <label for="support-challenge" data-translate="challengeLabel"></label>
          </div>
          <div class="multi-choice-item">
            <input type="checkbox" id="support-presence" name="effective_support" value="just_presence" />
            <label for="support-presence" data-translate="presenceLabel"></label>
          </div>
        </div>
      </div>
      <div class="navigation-buttons">
        <button class="btn btn-secondary" data-translate="backButton">Back</button>
        <button class="btn btn-primary" data-translate="continueButton">Continue</button>
      </div>
    </div>

    <div class="onboarding-box hidden" id="step-4">
      <div class="theme-header" data-translate="finalHeader"></div>
      <div class="question-section">
        <label class="question-label" data-translate="nameQuestion"></label>
        <div class="question-context" data-translate="nameContext"></div>
        <input type="text" id="ai_name" name="ai_name" value="Cael" />
      </div>
      <div class="navigation-buttons">
        <button class="btn btn-secondary" data-translate="backButton">Back</button>
        <button class="btn btn-primary" id="complete-button">
          <span data-translate="completeButton">Begin our journey</span>
          <span class="loading-spinner"></span>
        </button>
      </div>
    </div>

    <div class="skip-note" data-translate="skipNote"></div>
    <footer data-translate="footerText"></footer>

  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
  <script src="firebase-init.js"></script>
  <script>
    console.log('üîç DEBUG: Starting authentication debug...');
    if (typeof firebase === 'undefined') {
      console.error('‚ùå Firebase not loaded');
    } else {
      console.log('‚úÖ Firebase loaded');
    }
    let listenerCount = 0;
    const originalOnAuthStateChanged = firebase.auth().onAuthStateChanged;
    firebase.auth().onAuthStateChanged = function(...args) {
      listenerCount++;
      console.warn(`üö® Auth listener #${listenerCount} being registered!`);
      if (listenerCount > 1) {
        console.error('‚ùå MULTIPLE AUTH LISTENERS DETECTED');
        console.trace('Multiple listener trace:');
      }
      return originalOnAuthStateChanged.apply(this, args);
    };
  </script>
  <script type="module" src="js/onboarding.js"></script>
